<app-animated-logo *ngIf="isLoading"></app-animated-logo>

<div class="practice-container" *ngIf="!isLoading">
  <div class="practice-grid">
    <!-- Main Practice Area -->
    <div class="practice-main">
      <div class="main-card">
        <app-chord-display [chord]="chord" [nextChord]="nextChord" [voicing]="currentChordFingering" [beat]="beat"
          [dot]="dot" [started]="started" [isPaused]="isPaused" [muted]="muted" [tempo]="tempo"
          [isCountingDown]="isCountingDown" [countdownValue]="countdownValue" [denominator]="denominator"
          (start)="start()" (stop)="stop()" (pause)="pause()" (toggleMute)="toggleMute()"
          (updateTempo)="updateTempo($event)">
        </app-chord-display>


        <!-- AI Chord Feedback Section -->
        <div class="feedback-section">
          <div class="feedback-header">
            <h3>AI Assistant</h3>
            <button class="btn-listen" [class.listening]="isListening" (click)="toggleListening()">
              <span class="material-icons">{{ isListening ? 'mic_off' : 'mic' }}</span>
              {{ isListening ? 'Stop Listening' : 'Start Listening' }}
            </button>
          </div>
          <div class="feedback-display" *ngIf="isListening">
            <div class="feedback-message" [class.success]="feedbackMessage.includes('Correct')">
              {{ feedbackMessage }}
            </div>
            <div class="feedback-chord" *ngIf="feedbackChord">
              Heard: <strong>{{ feedbackChord }}</strong>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="section-header selected-chords-header">
            <h2>Progression Queue</h2>
            <button (click)="clearAll()" class="clear-all-button">Clear All</button>
          </div>
          <div class="selected-chords" cdkDropList cdkDropListOrientation="horizontal"
            (cdkDropListDropped)="drop($event)">
            <div *ngFor="let item of selChords; let i = index" class="chord-chip" cdkDrag>
              {{ item }}
              <img src="assets/icons/close.png" class="remove-chord" (click)="removeChord(i)" alt="Remove chord">
            </div>
            <div *ngIf="selChords.length === 0" style="color: #666; width: 100%; text-align: center; padding: 10px;">
              Select chords below to build your progression
            </div>
          </div>
        </div>
      </div>

      <app-circle-of-fifths *ngIf="progressionMode === 'circleOfFifths'"
        (familyChordsSelected)="onFamilyChordsSelected($event)" (chordSelected)="onCircleChordSelected($event)">
      </app-circle-of-fifths>

      <app-chord-selector *ngIf="progressionMode !== 'circleOfFifths'" [chords]="chords" [selChords]="selChords"
        (selectChord)="cardOnClick($event)" (clearAll)="clearAll()" (selectChordType)="onSelectChordType($event)">
      </app-chord-selector>
    </div>

    <!-- Right Sidebar Widgets -->
    <div class="practice-sidebar">
      <app-controls [beat]="beat" [progressionMode]="progressionMode" [started]="started" [isPaused]="isPaused"
        [muted]="muted" [tempo]="tempo" [isCountingDown]="isCountingDown" (setProgression)="setProgression($event)"
        (start)="start()" (stop)="stop()" (pause)="pause()" (toggleMute)="toggleMute()"
        (updateTempo)="updateTempo($event)">
        <app-time-signature-selector
          (timeSignatureChange)="onTimeSignatureChange($event)"></app-time-signature-selector>
      </app-controls>

      <!-- <app-daily-challenge></app-daily-challenge>
      <app-skills-tracker></app-skills-tracker>
      <app-tuner-widget></app-tuner-widget>
      <app-metronome-widget></app-metronome-widget>
      <app-teacher-widget></app-teacher-widget>
      <app-community-widget></app-community-widget> -->
    </div>
  </div>
</div>